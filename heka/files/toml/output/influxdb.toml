{%- from "heka/map.jinja" import server with context %}

[{{ output_name }}_output]
type = "HttpOutput"
message_matcher = "Fields[payload_type] == 'txt' && Fields[payload_name] == 'influxdb'"
encoder = "influxdb_encoder"
address = "http://{{ output.host }}:{{ output.port }}/write?db={{ output.database }}&precision={{ server.influxdb_time_precision }}"
{%- if output.username and output.password %}
username = "{{ output.username }}"
password = "{{ output.password }}"
{%- endif %}
http_timeout = 5000
method = "POST"
use_buffering = true

[influxdb_output.buffering]
max_buffer_size = 1610612736
max_file_size = 134217728
full_action = "drop"

[influxdb_output.headers]
Content-Type = ["application/x-www-form-urlencoded"]
